---
typora-copy-images-to: ..\file
---

# 为什么偏爱NodeJS

- 前端职责范围变大，统一开发体验：

  - 因为NodeJS 使用的语言是 JavaScript，前后端开发都使用javascript同一种语言，中间环节很容易打通）

    

- **事件驱动（event-driven）和异步I/O(non-blocking I/O)**特性：

  - nodeJS 并不是第一个可以在server端使用javaScript的。更早的有犀牛（javascript in java）

  - 让 nodeJS 胜出的原因在于它的这两个特性。

    

- 在处理**高并发、I/O密集**场景下性能优势明显。
  - 而**web 是 nodeJs 最适合的场景**。其中，**HTTP模块是 nodeJS中最重要的模块**。
  - NodeJS并不适合所有 server端的场景，它的使用场景是极其有限的。



>  问题：什么叫I/O密集？ NodeJs怎么就擅长web场景了呢？I/O密集和 web 有什么关系？



## CPU密集  &  I/O密集

- **CPU密集**：压缩，解压，加密，解密

  - 如果一个程序大部分时间用来做计算、逻辑判断等CPU动作，称之为“CPU密集”。
  - CPU密集型也叫计算密集型。
  - 图形计算也属于CPU密集，但是很多计算机把它罗列到了GPU。

- **I/O密集**：文件操作、网络操作（http相关）、数据库

- 特点：CPU运算非常快、IO操作非常慢。

  

> 我们可以把任务分为计算密集型和IO密集型。
>
> 计算密集型任务的特点是要进行大量的计算，消耗CPU资源，比如计算圆周率、对视频进行高清解码等等，全靠CPU的运算能力。这种计算密集型任务虽然也可以用多任务完成，但是任务越多，花在任务切换的时间就越多，CPU执行任务的效率就越低，所以，要最高效地利用CPU，计算密集型任务同时进行的数量应当等于CPU的核心数。
>
> 计算密集型任务由于主要消耗CPU资源，因此，代码运行效率至关重要。Python这样的脚本语言运行效率很低，完全不适合计算密集型任务。对于计算密集型任务，最好用C语言编写。
>
> 第二种任务的类型是IO密集型，涉及到网络、磁盘IO的任务都是IO密集型任务，这类任务的特点是CPU消耗很少，任务的大部分时间都在等待IO操作完成（因为IO的速度远远低于CPU和内存的速度）。对于IO密集型任务，任务越多，CPU效率越高，但也有一个限度。常见的大部分任务都是IO密集型任务，比如Web应用。
>
> IO密集型任务执行期间，99%的时间都花在IO上，花在CPU上的时间很少，因此，用运行速度极快的C语言替换用Python这样运行速度极低的脚本语言，完全无法提升运行效率。对于IO密集型任务，最合适的语言就是开发效率最高（代码量最少）的语言，脚本语言是首选，C语言最差。
>
> 总之，计算密集型程序适合C语言多线程，I/O密集型适合脚本语言开发的多线程。



## web常见场景

- 静态资源读取
  - 如 静态html，css，javascript
- 数据库操作
  - 需要读取存储设备
- 渲染页面
  - 读取模板文件-----IO操作
  - 根据模板文件生成html---CPU运算

由此可见，web就是一个典型的IO密集场景。



> 为什么 NodeJS相对于Java更擅长这种 web 场景？
>
> 因为对于上述静态资源读取、数据库操作、渲染页面相关前端web场景来说，用javascript会比java优势更明显一些。
>
> 当然如果是后端web场景，java可能更擅长。



> 既然 web 是 IO密集的，那么javascript到底做了什么让它更优势？



## 高并发应对之道

- 高并发：单位时间内访问量特别大。
- 增加机器数（通过负载均衡，处理高并发web请求）
- 增加每台机器的CPU数-----多核

> 增加机器数：
>
> 类似于饭店由原来的1个大厨增加到3个大厨。通过**增加数量**来负载均衡，处理高并发请求。
>
> 增加每台机器的CPU个数：
>
> 类似于饭店将大厨做饭的速度，由1倍提高到4倍。通过**提高效率**来处理高并发请求。



NodeJS性能好，指的是不通过上面两种方式，只在单台机器，单个CPU的前提。



## 进程

- 进程：是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位。
- 即正在进行中的程序，我们称之为“进程”。
- 多进程：启动多个进程，多个进程可以处理多个任务
- 单核处理多进程：是多个任务之间快速切换。

> 比如，用电脑听音乐、上网，对应的音乐播放器和浏览器都分别对应一个程序，当我们双击某个程序将它运行，实际上是将这个程序放到了内存中去执行。这个执行中的程序，就叫做进程。
>
> 程序运行需要操作系统底层分配给它相应资源，它才可以运行。而系统进行资源分配和调试的基本单位就是进程。
>
> 单核的CPU也是可以一边听音乐一边上网的，如何做到的？
>
> 程序放到内存中，按理说也是调CPU指令一句一句的执行，实际上听音乐和上网并不是同时执行的，而是快速切换不同的进程。





## NodeJS工作模型

- 线程：进程内一个相对独立的、可调度的执行单元，与同属一个进程的线程共享进程的资源
- 多线程：启动一个进程，在一个进程内启动多个线程，这样，多个线程也可以一块执行多个任务

![](https://github.com/yiqunkeke/node/blob/master/2.%20Node.js%E5%85%A5%E9%97%A8%E5%88%B0%E4%BC%81%E4%B8%9AWeb%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/file/nodejs-model.jpg)










